<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SMART DOOR CONTROL</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma;
        text-align: center;
        background: #eef2f6;
        margin: 0;
        padding: 0;
      }
      .container {
        background: #fff;
        width: 90%;
        max-width: 450px;
        margin: auto;
        margin-top: 40px;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
      }
      button {
        padding: 12px 25px;
        margin: 6px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        font-weight: 600;
      }
      .active {
        background: #007bff !important;
        color: white !important;
      }
      .open {
        background: #28a745;
        color: white;
      }
      .close {
        background: #dc3545;
        color: white;
      }
      #status {
        margin-top: 20px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 5px;
        color: #007bff;
        font-weight: 500;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>SMART DOOR CONTROL</h2>

      <p>SELECT MODE:</p>
      <button id="auto-btn" onclick="setMode('A')">AUTO</button>
      <button id="manu-btn" onclick="setMode('M')">MANUAL</button>

      <div id="manu-controls" style="display: none; margin-top: 15px">
        <p>MANUAL CONTROL:</p>
        <button class="open" onclick="sendControl('O')">OPEN DOOR</button>
        <button class="close" onclick="sendControl('C')">CLOSE DOOR</button>
      </div>

      <div style="margin-top: 20px">
        <p>HOLD TIME (ms):</p>
        <input
          type="range"
          id="holdSlider"
          min="500"
          max="5000"
          step="100"
          value="2000"
        />
        <p id="sliderValue">2000 ms</p>
      </div>

      <div id="status">Status: Loading...</div>
    </div>

    <script>
      let currentMode = 'A';

      // ---------------------------
      // Send command to ESP8266 API
      // ---------------------------
      function send(cmd) {
        fetch('/api/message?cmd=' + cmd)
          .then((r) => r.text())
          .then((t) => console.log('ESP->', t));
      }

      // ---------------------------
      // Change mode (A / M)
      // ---------------------------
      function setMode(cmd) {
        send(cmd);
        currentMode = cmd;
        updateUI();
      }

      // ---------------------------
      // Manual control (O / C)
      // ---------------------------
      function sendControl(cmd) {
        if (currentMode === 'M') {
          send(cmd);
          document.getElementById('status').innerText =
            'Status: Sending ' + cmd;
        }
      }

      // ---------------------------
      // Update UI state
      // ---------------------------
      function updateUI() {
        document.getElementById('auto-btn').classList.remove('active');
        document.getElementById('manu-btn').classList.remove('active');

        if (currentMode === 'A') {
          document.getElementById('auto-btn').classList.add('active');
          document.getElementById('manu-controls').style.display = 'none';
          document.getElementById('status').innerText = 'Status: AUTO Mode';
        } else {
          document.getElementById('manu-btn').classList.add('active');
          document.getElementById('manu-controls').style.display = 'block';
          document.getElementById('status').innerText = 'Status: MANUAL Mode';
        }
      }

      // ---------------------------
      // Slider event: send Txxxx
      // ---------------------------
      const slider = document.getElementById('holdSlider');
      const sliderValue = document.getElementById('sliderValue');

      slider.oninput = function () {
        sliderValue.innerText = this.value + ' ms';
        send('T' + this.value);
      };

      // ---------------------------
      // Load mode from ESP when page opens
      // ---------------------------
      window.onload = function () {
        fetch('/api/message?cmd=Q')
          .then((r) => r.text())
          .then((mode) => {
            if (mode === 'A' || mode === 'M') currentMode = mode;
            updateUI();
          });
      };
    </script>
  </body>
</html>
